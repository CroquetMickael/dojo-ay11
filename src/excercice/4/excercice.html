<html>
  <head lang="fr">
    <meta charset="UTF-8" />
    <title>My First Parcel App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../../../style.css" />
  </head>
  <body>
    <ul id="errors" class="bg-red-300 m-4 flex flex-col gap-1"></ul>
    <nav class="flex items-center justify-between flex-wrap bg-teal-500 p-6">
      <div class="flex items-center flex-shrink-0 text-white mr-6">
        <span class="font-semibold text-xl tracking-tight">AXA AY11 DOJO</span>
      </div>
      <div class="w-full block flex-grow lg:flex lg:items-center lg:w-auto">
        <div class="text-sm lg:flex-grow" id="liens">
          <a
            href="#responsive-header"
            class="block mt-4 lg:inline-block lg:mt-0 text-teal-200 hover:text-white mr-4"
          >
            Docs
          </a>
          <a
            href="#responsive-header"
            class="block mt-4 lg:inline-block lg:mt-0 text-teal-200 hover:text-white mr-4"
          >
            Examples
          </a>
          <a
            href="#responsive-header"
            class="block mt-4 lg:inline-block lg:mt-0 text-teal-200 hover:text-white"
          >
            Blog
          </a>
        </div>
      </div>
    </nav>
    <main class="bg-slate-200 h-screen">
      <h1 class="text-3xl font-bold underline p-4">Les formulaires</h1>
      <div class="flex items-center justify-center p-12">
        <div class="mx-auto w-full max-w-[550px]">
          <div id="form">
            <div class="-mx-3 flex flex-wrap" id="group">
              <div class="w-full px-3 sm:w-1/2">
                <div class="mb-5">
                  <span
                    id="label"
                    for="fName"
                    class="mb-3 block text-base font-medium text-[#07074D]"
                  >
                    Nom
                  </span>
                  <input
                    type="text"
                    name="nom"
                    id="nom"
                    placeholder="Nom"
                    class="w-full rounded-md border border-[#e0e0e0] bg-white py-3 px-6 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md"
                  />
                  <span id="error" class="text-red-400">Une erreur</span>
                </div>
              </div>
              <div class="w-full px-3 sm:w-1/2">
                <div class="mb-5">
                  <span
                    id="label"
                    for="lName"
                    class="mb-3 block text-base font-medium text-[#07074D]"
                  >
                    Prénom
                  </span>
                  <input
                    type="text"
                    name="lName"
                    id="lName"
                    placeholder="Prénom"
                    class="w-full rounded-md border border-[#e0e0e0] bg-white py-3 px-6 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md"
                  />
                </div>
              </div>
            </div>
            <div class="mb-5">
              <span
                id="label"
                for="invité"
                class="mb-3 block text-base font-medium text-[#07074D]"
              >
                Réservation pour combien d'invité ?
              </span>
              <input
                type="number"
                name="invité"
                id="invité"
                placeholder="5"
                min="0"
                class="w-full appearance-none rounded-md border border-[#e0e0e0] bg-white py-3 px-6 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md"
              />
            </div>

            <div class="-mx-3 flex flex-wrap" id="group">
              <div class="w-full px-3 sm:w-1/2">
                <div class="mb-5">
                  <span
                    id="label"
                    for="date"
                    class="mb-3 block text-base font-medium text-[#07074D]"
                  >
                    Date
                  </span>
                  <input
                    type="date"
                    name="date"
                    id="date"
                    class="w-full rounded-md border border-[#e0e0e0] bg-white py-3 px-6 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md"
                  />
                </div>
              </div>
              <div class="w-full px-3 sm:w-1/2">
                <div class="mb-5">
                  <span
                    id="label"
                    for="heure"
                    class="mb-3 block text-base font-medium text-[#07074D]"
                  >
                    Heure
                  </span>
                  <input
                    type="heure"
                    name="heure"
                    id="heure"
                    class="w-full rounded-md border border-[#e0e0e0] bg-white py-3 px-6 text-base font-medium text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md"
                  />
                </div>
              </div>
            </div>

            <div>
              <button
                class="hover:shadow-form rounded-md bg-[#6A64F1] py-3 px-8 text-center text-base font-semibold text-white outline-none"
              >
                Submit
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
    <footer class="bg-zinc-400">footer</footer>

    <div class="w-full flex justify-center p-4">
      <button
        onclick="validate()"
        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-1/2"
      >
        Valider l'excercice
      </button>
    </div>
  </body>

  <script>
    function validate() {
      const body = document.querySelector("body");
      const ul = document.querySelector("#errors");
      const errors = [];

      ul.innerHTML = "";

      // check that id form have node form
      const form = body.querySelector("[id=form]");
      if (form.nodeName === "FORM") {
        console.log("form est un form");
      } else {
        errors.push("L'id form n'est pas un form");
      }

      // get all id label and check that node is a label
      const labels = body.querySelectorAll("[id=label]");
      labels.forEach((label) => {
        if (label.nodeName !== "LABEL") {
          errors.push("L'un des id label n'est pas une balise label");
        }
      });

      // Check that id error have aria-live="assertive" and role="alert" attributes and is described by id nom
      const error = body.querySelector("[id=error]");
      if (error.getAttribute("aria-live") === "assertive") {
        console.log("aria-live est assertive");
      } else {
        errors.push("L'attribut aria-live n'est pas égale à assertive");
      }

      if (error.getAttribute("role") === "alert") {
        console.log("role est alert");
      } else {
        errors.push("L'attribut role n'est pas égale à alert");
      }

      if (error.getAttribute("aria-describedby") === "nom") {
        console.log("aria-describedby est égale à nom");
      } else {
        errors.push("L'attribut aria-describedby n'est pas égale à nom");
      }

      // check that id group have node fieldset
      const group = body.querySelector("[id=group]");
      if (group.nodeName === "FIELDSET") {
        console.log("group est un fieldset");
      } else {
        errors.push("L'un des id group n'est pas un fieldset");
      }

      // check that all group have a legend child
      group.childNodes.forEach((child) => {
        if (child.nodeName === "LEGEND") {
          console.log("child est un legend");
        } else {
          errors.push("L'un des enfants des id group n'est pas un legend");
        }
      });

      if (errors.length) {
        const formatedErrors = new Set(errors);
        ul.innerHTML = [...formatedErrors]
          .map((error) => `<li class="p-1">${error}</li>`)
          .join("");
      }

      if (errors.length === 0) {
        window.parent.postMessage("ex4", "*");
      }
    }
  </script>
</html>
